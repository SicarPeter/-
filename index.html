<!doctype html>
<html lang="zh-Hant-TW">
<head>
Â  <meta charset="utf-8" />
Â  <title>æ¨™è»Šé…·é ç´„ç³»çµ±</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
Â  <meta name="color-scheme" content="dark light" />
Â  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
Â  <link href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" rel="stylesheet" />
Â  <style>
Â  Â  :root{
Â  Â  Â  --bg:#191935; --card:#1f1f3f; --text:#f0f0f0; --muted:#9aa0b4;
Â  Â  Â  --accent:#D9F107; --input:#2a2a47; --border:#3f3f61; --danger:#ff8c8c; --success:#8cff8c;
Â  Â  Â  --ctrl-h:48px;
Â  Â  }
Â  Â  html,body{height:100%}
Â  Â  html{-webkit-text-size-adjust:100%}
Â  Â  body{
Â  Â  Â  font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,'Noto Sans','Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol',sans-serif;
Â  Â  Â  background:var(--bg); color:var(--text); margin:0; display:flex; align-items:center; justify-content:center;
Â  Â  Â  min-height:100svh;
Â  Â  Â  padding:
Â  Â  Â  Â  calc(16px + env(safe-area-inset-top))
Â  Â  Â  Â  16px
Â  Â  Â  Â  calc(16px + env(safe-area-inset-bottom))
Â  Â  Â  Â  16px;
Â  Â  }

Â  Â  @supports not (padding: max(0px)) {
Â  Â  Â  body{ padding-top: 24px; padding-bottom: 24px; }
Â  Â  }

Â  Â  @media (max-width:760px){
Â  Â  Â  body{ align-items:flex-start; }
Â  Â  Â  .container{ margin-top: 8px; }
Â  Â  }

Â  Â  .container{
Â  Â  Â  width:100%; max-width:720px; background:var(--card); border-radius:14px; padding:24px;
Â  Â  Â  box-shadow:0 10px 30px rgba(0,0,0,.35);
Â  Â  }
Â  Â  h1{margin:0; font-size:clamp(22px,4.2vw,32px); color:var(--accent); text-align:center; font-weight:800;}
Â  Â  .sub{margin:6px 0 18px; text-align:center; color:var(--muted); font-size:14px}

Â  Â  .grid{display:grid; gap:16px}
Â  Â  .row{
Â  Â  Â  display:grid; grid-template-columns:1fr 1fr; gap:16px;
Â  Â  Â  align-items:start;
Â  Â  }
Â  Â  @media (max-width:760px){ .row{ grid-template-columns:1fr; } }

Â  Â  .form-group{display:flex; flex-direction:column; gap:8px}
Â  Â  label{font-weight:700; font-size:14px}

Â  Â  .control{
Â  Â  Â  font:inherit; font-size:16px;
Â  Â  Â  height:var(--ctrl-h); padding:12px 14px; line-height:normal;
Â  Â  Â  width:100%; border-radius:10px; border:1px solid var(--border);
Â  Â  Â  background:var(--input); color:var(--text); box-sizing:border-box;
Â  Â  }
Â  Â  select.control{ background-image:none; padding-right:14px; }
Â  Â  @supports (-webkit-touch-callout:none){
Â  Â  Â  select.control{ padding-top:12px; padding-bottom:12px; }
Â  Â  }

Â  Â  textarea.control{ height:auto; min-height:96px; line-height:1.5 }
Â  Â  .help{color:var(--muted); font-size:12px}

Â  Â  button.control{
Â  Â  Â  background:var(--accent); color:#101020; border:none; font-weight:800; cursor:pointer;
Â  Â  Â  height:var(--ctrl-h);
Â  Â  }
Â  Â  button.control:disabled{opacity:.6; cursor:not-allowed}

Â  Â  /* âœ… ç§»é™¤åŸæœ¬çš„ status æ¨£å¼ï¼Œæ”¹ç”¨ modal */
Â  Â  /* #status{display:none; margin-top:4px; font-weight:700; text-align:center}
Â  Â  #status.success{display:block; color:var(--success)}
Â  Â  #status.error{display:block; color:var(--danger)} */

Â  Â  /* âœ… æ–°å¢ï¼šå½ˆè·³è¦–çª—æ¨£å¼ */
Â  Â  .modal-overlay{
Â  Â  Â  position:fixed; top:0; left:0; width:100%; height:100%;
Â  Â  Â  background:rgba(0,0,0,.6); backdrop-filter:blur(3px); -webkit-backdrop-filter:blur(3px);
Â  Â  Â  display:flex; align-items:center; justify-content:center;
Â  Â  Â  opacity:0; visibility:hidden; transition:opacity .3s, visibility .3s;
Â  Â  Â  padding:16px;
Â  Â  Â  z-index:9999;
Â  Â  }
Â  Â  .modal-overlay.show{opacity:1; visibility:visible}
Â  Â  .modal-content{
Â  Â  Â  background:var(--card); color:var(--text); padding:24px; border-radius:14px;
Â  Â  Â  width:100%; max-width:400px; text-align:center;
Â  Â  Â  transform:scale(.9); transition:transform .3s;
Â  Â  Â  position:relative;
Â  Â  }
Â  Â  .modal-overlay.show .modal-content{transform:scale(1)}

Â  Â  .modal-content .icon{
Â  Â  Â  font-size:48px; margin-bottom:16px;
Â  Â  }
Â  Â  .modal-content .message{
Â  Â  Â  font-weight:700; font-size:18px; margin-bottom:16px;
Â  Â  }
Â  Â  .modal-content .close-btn{
Â  Â  Â  background:var(--accent); color:#101020; border:none; font-weight:800; cursor:pointer;
Â  Â  Â  height:44px; width:100%; border-radius:8px;
Â  Â  }
Â  Â  .modal-content.success .icon{color:var(--success)}
Â  Â  .modal-content.error .icon{color:var(--danger)}

Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <h1>æ¨™è»Šé…·é ç´„ç³»çµ±</h1>
Â  Â  <p class="sub">å®šé»æª¢æ¸¬ Â· å°åŒ—å¸‚ä¸­å±±å€æ¿±æ±Ÿè¡— 326-1 è™Ÿ</p>

Â  Â  <form id="form" class="grid" novalidate>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label for="item">é ç´„é …ç›®</label>
Â  Â  Â  Â  <select id="item" name="item" class="control" required>
Â  Â  Â  Â  Â  <option value="è»Šè¼›æª¢æ¸¬">è»Šè¼›æª¢æ¸¬</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="datepicker">æ—¥æœŸ</label>
Â  Â  Â  Â  Â  <input id="datepicker" name="date" type="text" class="control" inputmode="none" autocomplete="off" placeholder="è«‹å…ˆé¸æ“‡æ—¥æœŸ" readonly required>
Â  Â  Â  Â  Â  <div class="help">å¯ç´„ 2 å€‹æœˆå…§</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="slot">æ™‚æ®µ</label>
Â  Â  Â  Â  Â  <select id="slot" name="time" class="control" required disabled>
Â  Â  Â  Â  Â  Â  <option value="">è«‹å…ˆé¸æ“‡æ—¥æœŸ</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="brand">å» ç‰Œ</label>
Â  Â  Â  Â  Â  <select id="brand" name="brand" class="control" required disabled>
Â  Â  Â  Â  Â  Â  <option value="">è¼‰å…¥ä¸­...</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="model">è»Šæ¬¾</label>
Â  Â  Â  Â  Â  <select id="model" name="model" class="control" required disabled>
Â  Â  Â  Â  Â  Â  <option value="">è«‹å…ˆé¸æ“‡å» ç‰Œ</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="name">å§“å</label>
Â  Â  Â  Â  Â  <input id="name" name="name" type="text" class="control" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="phone">æ‰‹æ©Ÿè™Ÿç¢¼</label>
Â  Â  Â  Â  Â  <input id="phone" name="phone" type="tel" class="control" inputmode="numeric" pattern="^(09|\\+?8869)\\d{8}$" placeholder="09xxxxxxxx" required>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label for="email">é›»å­éƒµä»¶</label>
Â  Â  Â  Â  <input id="email" name="email" type="email" class="control" placeholder="example@gmail.com" required>
Â  Â  Â  </div>

Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label for="memo">å‚™è¨»ï¼ˆå¯è¼¸å…¥ LINE ID æˆ–å…¶ä»–éœ€æ±‚ï¼‰</label>
Â  Â  Â  Â  <textarea id="memo" name="memo" class="control" rows="3" placeholder="é¸å¡«"></textarea>
Â  Â  Â  </div>

Â  Â  Â  <button id="submit" type="submit" class="control">ç«‹å³é ç´„</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  </form>
Â  </div>

Â  Â  <div id="modal" class="modal-overlay">
Â  Â  <div class="modal-content">
Â  Â  Â  <div id="modal-icon" class="icon"></div>
Â  Â  Â  <div id="modal-message" class="message"></div>
Â  Â  Â  <button id="modal-close" class="close-btn">ç¢ºèª</button>
Â  Â  </div>
Â  </div>

Â  <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
Â  <script>
Â  Â  /* ===== Endpoints ===== */
Â  Â  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxKNqFkl3FqdskRQ_zUD3xvsfUPPuI5RT-5qDW242o3WedCHGNdNT3U-m6k8XT1nG8o/exec';
Â  Â  const BRAND_JSON = './data/brands.json';
Â  Â  const MODEL_JSON = './data/models.json';

Â  Â  /* ===== DOM ===== */
Â  Â  const form = document.getElementById('form');
Â  Â  const dateEl = document.getElementById('datepicker');
Â  Â  const slotEl = document.getElementById('slot');
Â  Â  const brandEl = document.getElementById('brand');
Â  Â  const modelEl = document.getElementById('model');
Â  Â  const submitBtn = document.getElementById('submit');

Â  Â  // âœ… æ–°å¢ï¼šå½ˆè·³è¦–çª—çš„ DOM
Â  Â  const modalEl = document.getElementById('modal');
Â  Â  const modalContentEl = document.getElementById('modal-content');
Â  Â  const modalIconEl = document.getElementById('modal-icon');
Â  Â  const modalMessageEl = document.getElementById('modal-message');
Â  Â  const modalCloseBtn = document.getElementById('modal-close');

Â  Â  /* ===== Date Picker ===== */
Â  Â  const today = new Date();
Â  Â  const max = new Date(); max.setMonth(max.getMonth() + 2);
Â  Â  const picker = new Litepicker({
Â  Â  Â  element: dateEl,
Â  Â  Â  singleMode: true,
Â  Â  Â  lang: 'zh-TW',
Â  Â  Â  format: 'YYYY-MM-DD',
Â  Â  Â  minDate: today,
Â  Â  Â  maxDate: max,
Â  Â  Â  autoApply: true,
Â  Â  Â  mobileFriendly: true,
Â  Â  });
Â  Â  picker.on('selected', (date) => {
Â  Â  Â  const d = date ? date.format('YYYY-MM-DD') : '';
Â  Â  Â  if (d) fetchSlots(d);
Â  Â  });

Â  Â  /* ===== Local cacheï¼ˆbrandsï¼š24hï¼›modelsï¼šæ¯å“ç‰Œ 6hï¼‰ ===== */
Â  Â  const LS = {
Â  Â  Â  get(k, sec){
Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  const v = JSON.parse(localStorage.getItem(k) || 'null');
Â  Â  Â  Â  Â  if(!v) return null;
Â  Â  Â  Â  Â  if(sec && (Date.now() - v.t)/1000 > sec) return null;
Â  Â  Â  Â  Â  return v.v;
Â  Â  Â  Â  }catch{return null}
Â  Â  Â  },
Â  Â  Â  set(k, v){ localStorage.setItem(k, JSON.stringify({t:Date.now(), v})) }
Â  Â  };

Â  Â  /* ===== åˆå§‹åŒ–ï¼šå“ç‰Œ ===== */
Â  Â  initBrands();
Â  Â  async function initBrands(){
Â  Â  Â  brandEl.disabled = true;
Â  Â  Â  brandEl.innerHTML = '<option value="">è¼‰å…¥ä¸­...</option>';

Â  Â  Â  const cached = LS.get('brands', 86400);
Â  Â  Â  if (cached) renderBrands(cached);

Â  Â  Â  try{
Â  Â  Â  Â  const res = await fetch(BRAND_JSON, {cache:'force-cache'});
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  // å®¹éŒ¯æ”¯æŒå¤šç¨®æ ¼å¼
Â  Â  Â  Â  let list = [];
Â  Â  Â  Â  if (Array.isArray(data)) {
Â  Â  Â  Â  Â  list = data.map(x => typeof x === 'string' ? ({id:x, name:x}) : ({id:(x.id??x.value??x.code??x.name), name:(x.name??x.label??String(x.id??x.value??x.code??x))}));
Â  Â  Â  Â  } else if (data && Array.isArray(data.brands)) {
Â  Â  Â  Â  Â  list = data.brands.map(x => typeof x === 'string' ? ({id:x, name:x}) : ({id:(x.id??x.value??x.code??x.name), name:(x.name??x.label??String(x.id??x.value??x.code??x))}));
Â  Â  Â  Â  } else if (data && typeof data === 'object') {
Â  Â  Â  Â  Â  list = Object.keys(data).map(k => ({id:k, name:k}));
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!list.length) throw new Error('brands.json æ ¼å¼ä¸ç¬¦');

Â  Â  Â  Â  LS.set('brands', list);
Â  Â  Â  Â  renderBrands(list);

Â  Â  Â  Â  // é æŠ“ç¬¬ä¸€å€‹å“ç‰Œè»Šæ¬¾ï¼ŒåŠ é€Ÿé«”æ„Ÿ
Â  Â  Â  Â  const first = list[0]?.id;
Â  Â  Â  Â  if (first) fetchModels(first, {silent:true});
Â  Â  Â  }catch(e){
Â  Â  Â  Â  console.warn('load brands error', e);
Â  Â  Â  Â  if (!cached){
Â  Â  Â  Â  Â  brandEl.innerHTML = '<option value="">å“ç‰Œè¼‰å…¥å¤±æ•—</option>';
Â  Â  Â  Â  Â  brandEl.disabled = true;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  brandEl.addEventListener('change', () => {
Â  Â  Â  const id = brandEl.value;
Â  Â  Â  if (!id){
Â  Â  Â  Â  modelEl.disabled = true;
Â  Â  Â  Â  modelEl.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡å» ç‰Œ</option>';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  fetchModels(id);
Â  Â  });

Â  Â  async function fetchModels(brandId, {silent=false} = {}){
Â  Â  Â  const CK = 'models:' + brandId;
Â  Â  Â  const cached = LS.get(CK, 21600);
Â  Â  Â  if (cached) renderModels(cached);

Â  Â  Â  if (!silent){
Â  Â  Â  Â  modelEl.disabled = true;
Â  Â  Â  Â  modelEl.innerHTML = '<option value="">è¼‰å…¥ä¸­...</option>';
Â  Â  Â  }

Â  Â  Â  try{
Â  Â  Â  Â  const res = await fetch(MODEL_JSON, {cache:'force-cache'});
Â  Â  Â  Â  const data = await res.json();

Â  Â  Â  Â  let list = [];
Â  Â  Â  Â  if (Array.isArray(data)) {
Â  Â  Â  Â  Â  // æ‰å¹³é™£åˆ—ï¼š[{id, brand_id, name}]
Â  Â  Â  Â  Â  list = data.filter(x => String(x.brand_id??x.brandId??x.BrandId) === String(brandId))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .map(x => ({id:(x.id??x.value??x.code??x.name), name:(x.name??x.label??String(x.id))}));
Â  Â  Â  Â  } else if (data && typeof data === 'object') {
Â  Â  Â  Â  Â  // map çµæ§‹ï¼š{ "TOYOTA":[{id,name}æˆ–"Altis"] , "1":[...] }
Â  Â  Â  Â  Â  const byKey = data[String(brandId)] || data[brandEl.options[brandEl.selectedIndex].text] || null;
Â  Â  Â  Â  Â  if (Array.isArray(byKey)) {
Â  Â  Â  Â  Â  Â  list = byKey.map(x => typeof x === 'string' ? ({id:x, name:x}) : ({id:(x.id??x.value??x.code??x.name), name:(x.name??x.label??String(x.id))}));
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!list.length) {
Â  Â  Â  Â  Â  modelEl.disabled = true;
Â  Â  Â  Â  Â  modelEl.innerHTML = '<option value="">æ­¤å» ç‰Œå°šç„¡è»Šæ¬¾</option>';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  LS.set(CK, list);
Â  Â  Â  Â  renderModels(list);

Â  Â  Â  }catch(e){
Â  Â  Â  Â  console.warn('load models error', e);
Â  Â  Â  Â  if (!cached){
Â  Â  Â  Â  Â  modelEl.disabled = true;
Â  Â  Â  Â  Â  modelEl.innerHTML = '<option value="">è»Šæ¬¾è¼‰å…¥å¤±æ•—</option>';
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  function renderBrands(list){
Â  Â  Â  brandEl.innerHTML = '<option value="">è«‹é¸æ“‡å» ç‰Œ</option>';
Â  Â  Â  list.forEach(b => brandEl.appendChild(new Option(String(b.name), String(b.id))));
Â  Â  Â  brandEl.disabled = false;
Â  Â  }
Â  Â  function renderModels(list){
Â  Â  Â  modelEl.innerHTML = '<option value="">è«‹é¸æ“‡è»Šæ¬¾</option>';
Â  Â  Â  list.forEach(m => modelEl.appendChild(new Option(String(m.name), String(m.id))));
Â  Â  Â  modelEl.disabled = false;
Â  Â  }

Â  Â  /* ===== æ™‚æ®µï¼ˆApps Scriptï¼‰ ===== */
Â  Â  async function fetchSlots(dateStr) {
Â  Â  Â  slotEl.disabled = true;
Â  Â  Â  slotEl.innerHTML = `<option value="">è¼‰å…¥ä¸­...</option>`;
Â  Â  Â  try {
Â  Â  Â  Â  const url = `${APPS_SCRIPT_URL}?action=slots&date=${encodeURIComponent(dateStr)}`;
Â  Â  Â  Â  const res = await fetch(url, { method: 'GET', mode: 'cors' });
Â  Â  Â  Â  const json = await res.json();
Â  Â  Â  Â  if (!json.success) throw new Error(json.message || 'ç„¡æ³•è¼‰å…¥æ™‚æ®µ');
Â  Â  Â  Â  const slots = json.data || {};
Â  Â  Â  Â  const keys = Object.keys(slots).sort();

Â  Â  Â  Â  slotEl.innerHTML = '';
Â  Â  Â  Â  if (!keys.length){
Â  Â  Â  Â  Â  slotEl.innerHTML = `<option value="">ç•¶æ—¥å·²ç„¡å¯é ç´„æ™‚æ®µ</option>`;
Â  Â  Â  Â  Â  slotEl.disabled = true;
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  slotEl.appendChild(new Option('è«‹é¸æ“‡æ™‚æ®µ',''));
Â  Â  Â  Â  keys.forEach(k => slotEl.appendChild(new Option(`${k}ï¼ˆå‰©é¤˜ ${slots[k]} ä½ï¼‰`, k)));
Â  Â  Â  Â  slotEl.disabled = false;
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  slotEl.innerHTML = `<option value="">ç„¡æ³•è¼‰å…¥æ™‚æ®µ</option>`;
Â  Â  Â  Â  slotEl.disabled = true;
Â  Â  Â  }
Â  Â  }

Â  Â  /* ===== é€å‡ºï¼ˆx-www-form-urlencodedï¼Œé¿å… CORS é æª¢ï¼‰ ===== */
Â  Â  form.addEventListener('submit', async (e) => {
Â  Â  Â  e.preventDefault();

Â  Â  Â  const requiredIds = ['item','datepicker','slot','brand','model','name','phone','email'];
Â  Â  Â  for (const id of requiredIds) {
Â  Â  Â  Â  const el = document.getElementById(id);
Â  Â  Â  Â  if (!el || !el.value) { showModal('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ã€‚','error'); return; }
Â  Â  Â  }

Â  Â  Â  submitBtn.disabled = true; submitBtn.textContent = 'æäº¤ä¸­...'; showModal('','hide');

Â  Â  Â  try {
Â  Â  Â  Â  const params = new URLSearchParams();
Â  Â  Â  Â  params.set('action','reserve');
Â  Â  Â  Â  params.set('item',Â  document.getElementById('item').value);
Â  Â  Â  Â  params.set('date',Â  dateEl.value);
Â  Â  Â  Â  params.set('time',Â  slotEl.value);
Â  Â  Â  Â  params.set('name',Â  document.getElementById('name').value);
Â  Â  Â  Â  params.set('phone', document.getElementById('phone').value);
Â  Â  Â  Â  params.set('email', document.getElementById('email').value);
Â  Â  Â  Â  params.set('memo',Â  document.getElementById('memo').value || '');
Â  Â  Â  Â  params.set('brand', brandEl.value);
Â  Â  Â  Â  params.set('model', modelEl.value);

Â  Â  Â  Â  const resÂ  = await fetch(APPS_SCRIPT_URL, {
Â  Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  Â  headers:{ 'Content-Type':'application/x-www-form-urlencoded;charset=utf-8' },
Â  Â  Â  Â  Â  body: params.toString(),
Â  Â  Â  Â  Â  mode:'cors',
Â  Â  Â  Â  });

Â  Â  Â  Â  const ct = res.headers.get('content-type') || '';
Â  Â  Â  Â  const data = ct.includes('application/json') ? await res.json()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : { success:false, message:'ä¼ºæœå™¨æœªå› JSONï¼ˆè«‹ç¢ºèª Web App æ¬Šé™/éƒ¨ç½²ï¼‰' };

Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  showModal(data.message || 'é ç´„æˆåŠŸï¼','success'); // âœ… é€™è£¡å‘¼å«æ–°çš„å‡½å¼
Â  Â  Â  Â  Â  form.reset();
Â  Â  Â  Â  Â  slotEl.innerHTML = `<option value="">è«‹å…ˆé¸æ“‡æ—¥æœŸ</option>`; slotEl.disabled = true;
Â  Â  Â  Â  Â  modelEl.innerHTML = `<option value="">è«‹å…ˆé¸æ“‡å» ç‰Œ</option>`; modelEl.disabled = true;
Â  Â  Â  Â  Â  initBrands();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  throw new Error(data.message || 'é ç´„å¤±æ•—');
Â  Â  Â  Â  }
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  showModal(err.message || 'é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚','error'); // âœ… é€™è£¡å‘¼å«æ–°çš„å‡½å¼
Â  Â  Â  } finally {
Â  Â  Â  Â  submitBtn.disabled = false; submitBtn.textContent = 'ç«‹å³é ç´„';
Â  Â  Â  }
Â  Â  });

Â  Â  // âœ… æ–°å¢ï¼šå½ˆè·³è¦–çª—æ§åˆ¶å‡½å¼
Â  Â  function showModal(msg, type){
Â  Â  Â  if (type === 'hide'){
Â  Â  Â  Â  modalEl.classList.remove('show');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  modalMessageEl.textContent = msg || '';
Â  Â  Â  modalContentEl.className = 'modal-content'; // é‡è¨­ class
Â  Â  Â  if (type === 'success'){
Â  Â  Â  Â  modalContentEl.classList.add('success');
Â  Â  Â  Â  modalIconEl.textContent = 'ğŸ‰';
Â  Â  Â  } else if (type === 'error'){
Â  Â  Â  Â  modalContentEl.classList.add('error');
Â  Â  Â  Â  modalIconEl.textContent = 'ğŸš«';
Â  Â  Â  }
Â  Â  Â  modalEl.classList.add('show');
Â  Â  }

Â  Â  // âœ… æ–°å¢ï¼šå½ˆè·³è¦–çª—é—œé–‰äº‹ä»¶
Â  Â  modalCloseBtn.addEventListener('click', () => {
Â  Â  Â  showModal('','hide');
Â  Â  });
Â  Â  modalEl.addEventListener('click', (e) => {
Â  Â  Â  if (e.target.id === 'modal') showModal('','hide');
Â  Â  });


Â  Â  // é¿å… iOS é›™æ“Šæ”¾å¤§
Â  Â  let lastTouch = 0;
Â  Â  document.addEventListener('touchend', (e)=>{
Â  Â  Â  const now = Date.now();
Â  Â  Â  if (now - lastTouch <= 300) e.preventDefault();
Â  Â  Â  lastTouch = now;
Â  Â  }, {passive:false});
Â  </script>
</body>
</html>
