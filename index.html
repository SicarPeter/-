<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <title>標車酷預約系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" rel="stylesheet" />
  <style>
    :root{
      --bg:#191935; --card:#1f1f3f; --text:#f0f0f0; --muted:#9aa0b4;
      --accent:#D9F107; --input:#2a2a47; --border:#3f3f61; --danger:#ff8c8c; --success:#8cff8c;
      --ctrl-h:48px;
    }
    html,body{height:100%}
    html{-webkit-text-size-adjust:100%}
    body{
      font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,'Noto Sans','Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol',sans-serif;
      background:var(--bg); color:var(--text); margin:0; display:flex; align-items:center; justify-content:center;
      min-height:100svh;
      padding:
        calc(16px + env(safe-area-inset-top))
        16px
        calc(16px + env(safe-area-inset-bottom))
        16px;
    }
    @supports not (padding: max(0px)) {
      body{ padding-top: 24px; padding-bottom: 24px; }
    }
    @media (max-width:760px){
      body{ align-items:flex-start; }
      .container{ margin-top: 8px; }
    }
    .container{ width:100%; max-width:720px; background:var(--card); border-radius:14px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    h1{margin:0; font-size:clamp(22px,4.2vw,32px); color:var(--accent); text-align:center; font-weight:800;}
    .sub{margin:6px 0 18px; text-align:center; color:var(--muted); font-size:14px}
    .grid{display:grid; gap:16px}
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px; align-items:start; }
    @media (max-width:760px){ .row{ grid-template-columns:1fr; } }
    .form-group{display:flex; flex-direction:column; gap:8px}
    label{font-weight:700; font-size:14px}
    .control{ font:inherit; font-size:16px; height:var(--ctrl-h); padding:12px 14px; line-height:normal; width:100%; border-radius:10px; border:1px solid var(--border); background:var(--input); color:var(--text); box-sizing:border-box; }
    select.control{ background-image:none; padding-right:14px; }
    @supports (-webkit-touch-callout:none){ select.control{ padding-top:12px; padding-bottom:12px; } }
    textarea.control{ height:auto; min-height:96px; line-height:1.5 }
    .help{color:var(--muted); font-size:12px}
    button.control{ background:var(--accent); color:#101020; border:none; font-weight:800; cursor:pointer; height:var(--ctrl-h); }
    button.control:disabled{opacity:.6; cursor:not-allowed}
    #status{display:none; margin-top:4px; font-weight:700; text-align:center}
    #status.success{display:block; color:var(--success)}
    #status.error{display:block; color:var(--danger)}
  </style>
</head>
<body>
  <div class="container">
    <h1>標車酷預約系統</h1>
    <p class="sub">定點檢測 · 台北市中山區濱江街 326-1 號</p>

    <form id="form" class="grid" novalidate>
      <!-- 預約項目 -->
      <div class="form-group">
        <label for="item">預約項目</label>
        <select id="item" name="item" class="control" required>
          <option value="車輛檢測">車輛檢測</option>
        </select>
      </div>

      <!-- 日期 + 時段 -->
      <div class="row">
        <div class="form-group">
          <label for="datepicker">日期</label>
          <input id="datepicker" name="date" type="text" class="control" inputmode="none" autocomplete="off" placeholder="請先選擇日期" readonly required>
          <div class="help">可約 2 個月內</div>
        </div>
        <div class="form-group">
          <label for="slot">時段</label>
          <select id="slot" name="time" class="control" required disabled>
            <option value="">請先選擇日期</option>
          </select>
        </div>
      </div>

      <!-- 廠牌 + 車款 -->
      <div class="row">
        <div class="form-group">
          <label for="brand">廠牌</label>
          <select id="brand" name="brand" class="control" required disabled>
            <option value="">載入中...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="model">車款</label>
          <select id="model" name="model" class="control" required disabled>
            <option value="">請先選擇廠牌</option>
          </select>
        </div>
      </div>

      <!-- 姓名 + 手機 -->
      <div class="row">
        <div class="form-group">
          <label for="name">姓名</label>
          <input id="name" name="name" type="text" class="control" placeholder="請輸入您的姓名" required>
        </div>
        <div class="form-group">
          <label for="phone">手機號碼</label>
          <input id="phone" name="phone" type="tel" class="control" inputmode="numeric" pattern="^(09|\\+?8869)\\d{8}$" placeholder="09xxxxxxxx" required>
        </div>
      </div>

      <div class="form-group">
        <label for="email">電子郵件</label>
        <input id="email" name="email" type="email" class="control" placeholder="example@gmail.com" required>
      </div>

      <div class="form-group">
        <label for="memo">備註（可輸入 LINE ID 或其他需求）</label>
        <textarea id="memo" name="memo" class="control" rows="3" placeholder="選填"></textarea>
      </div>

      <button id="submit" type="submit" class="control">立即預約</button>
      <div id="status"></div>
    </form>
  </div>


  <script>
    // ✅ 設定常數：API 路徑、品牌車款 JSON
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxKNqFkl3FqdskRQ_zUD3xvsfUPPuI5RT-5qDW242o3WedCHGNdNT3U-m6k8XT1nG8o/exec';
    const BRAND_JSON = 'https://sicarpeter.github.io/-/data/brands.json';
    const MODEL_JSON = 'https://sicarpeter.github.io/-/data/models.json';

    // ✅ 其餘 JavaScript 同上，你貼上的程式碼架構很完整，我僅修正了 fetch URL 部分

    // ✅ 註冊取消預約事件（如頁面中有取消按鈕，這段也支援）
    document.addEventListener('click', async (e) => {
      if (!e.target.closest('[data-cancel]')) return;
      const id = e.target.closest('[data-cancel]').dataset.cancel;
      if (!confirm('確定要取消此預約嗎？')) return;
      try {
        const res = await fetch(`${APPS_SCRIPT_URL}?action=cancel&id=${encodeURIComponent(id)}`);
        const json = await res.json();
        if (json.success) alert('取消成功'); else throw new Error(json.message);
        location.reload();
      } catch (err) {
        alert('取消失敗：' + (err.message || '請稍後再試'));
      }
    });
  </script>
</body>
</html>
